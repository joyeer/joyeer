//
// Created by Qing Xu on 2021/10/16.
//

#ifndef __joyeer_compiler_typedef_h__
#define __joyeer_compiler_typedef_h__

#include <string>
#include <utility>

enum JrTypeType : uint8_t {
    Void = 0x00,
    Nil,
    Boolean,
    Integer,
    Long,
    Any,
    String,
    Class,
    Module,
    Function,
};

// typedef is generated by compiler, which represent a **Type**
struct JrTypeDef {
    using Ptr = std::shared_ptr<JrTypeDef>;
    const std::string name;
    JrTypeType type;

    JrTypeDef(std::string  name, JrTypeType type):
        name(std::move(name)),
        type(type) {
    }
};

// represent Nil type
struct JrNilTypeDef : JrTypeDef {
    using Ptr = std::shared_ptr<JrNilTypeDef>;
    JrNilTypeDef();
};

// represent Void type
struct JrVoidTypeDef : JrTypeDef {
    using Ptr = std::shared_ptr<JrVoidTypeDef>;
    JrVoidTypeDef();
};

enum JrFuncTypeType : uint8_t {
    C_Func,
    VM_Func
};

// Represent Function type (include class's function type)
struct JrFuncTypeDef : JrTypeDef {
    using Ptr = std::shared_ptr<JrFuncTypeDef>;

    JrFuncTypeType funcType;

    explicit JrFuncTypeDef(const std::string& name);
};

// Represent Int type
struct JrIntTypeDef : JrTypeDef {
    using Ptr = std::shared_ptr<JrIntTypeDef>;
    JrIntTypeDef();
};

// Represent Bool type
struct JrBoolTypeDef : JrTypeDef {
    using Ptr = std::shared_ptr<JrBoolTypeDef>;
    JrBoolTypeDef();
};

struct JrClassTypeDef: JrTypeDef {
    using Ptr = std::shared_ptr<JrClassTypeDef>;
    explicit JrClassTypeDef(const std::string& name);

    static JrClassTypeDef::Ptr create(const std::string& name) {
        return std::make_shared<JrClassTypeDef>(name);
    }
};

struct JrModuleTypeDef : JrClassTypeDef {
    using Ptr = std::shared_ptr<JrModuleTypeDef>;
    explicit JrModuleTypeDef(const std::string& name);
};

namespace BuildIn::TypeDef {
    [[maybe_unused]] static const JrVoidTypeDef::Ptr Void = std::make_shared<JrVoidTypeDef>();
    [[maybe_unused]] static const JrNilTypeDef::Ptr Nil = std::make_shared<JrNilTypeDef>();
    [[maybe_unused]] static const JrIntTypeDef::Ptr Int = std::make_shared<JrIntTypeDef>();
    [[maybe_unused]] static const JrBoolTypeDef::Ptr Bool = std::make_shared<JrBoolTypeDef>();


};

#endif //__joyeer_compiler_typedef_h__
